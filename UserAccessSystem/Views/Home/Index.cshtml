@{
    ViewBag.Title = "User Access System";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>@ViewBag.Title</h2>

<table id="grid-basic" class="table table-condensed table-hover table-striped">
    <thead>
        <tr>
            <th data-column-id="Id" data-type="numeric" data-identifier="true">Id</th>
            <th data-column-id="FirstName">First name</th>
            <th data-column-id="LastName">Last name</th>
            <th data-column-id="LastSubscription">Last subscription</th>
            <th data-column-id="IsActiveAccount">Active</th>
            <th data-column-id="IsSuperUser">Administrator</th>
        </tr>
    </thead>
</table>

<div id="userGridActions" style="display: flex">
    <button id="btnAddUser" type="button" class="btn btn-primary" style="float: right">Add user</button>
    <button id="btnEditUser" type="button" class="btn btn-default" style="float: right">Update user</button>
    <button id="btnRemoveUser" type="button" class="btn btn-danger" style="float: right">Remove users</button>
</div>

<div id="popupAddUser"></div>
<div id="popupEditUser"></div>

@* ReSharper disable PossiblyUnassignedProperty *@
<script type="text/javascript">
    $("#grid-basic").bootgrid({
        ajax: true,
        post: function () {
            return {
                id: "x8gt2424-1ht7-4jh5-8123-78duqklqugej"
            };
        },
        url: "Home/GetAllUsers",
        selection: true,
        multiSelect: true,
        rowSelect: false,
        keepSelection: true,
        templates: {
            search: ""
        },
        navigation: 0
    }).on("selected.rs.jquery.bootgrid", function (e, rows) {
        //var rowIds = [];
        //for (var i = 0; i < rows.length; i++) {
        //    rowIds.push(rows[i].Id);
        //}
    });

    //#### ADD USER ####//

    var configAdd = {
        autoOpen: false,
        position: { my: "top+150px", at: "top", of: window },
        resizable: false,
        title: 'Add User',
        modal: true,
        open: function () {
            $(this).load('@Url.Action("AddUserPopup", "Home")');
        }
    };

    $("#popupAddUser").dialog(configAdd);

    $("#btnAddUser").on("click", function() {
        $("#popupAddUser").dialog(configAdd).dialog("open");
    });

    //#### EDIT USER ####//

    $("#btnEditUser").on("click", function() {
        var selectedRows = $("#grid-basic").bootgrid("getSelectedRows");

        var configEdit = {
            autoOpen: false,
            position: { my: "top+150px", at: "top", of: window },
            resizable: false,
            title: 'Update User',
            modal: true,
            open: function() {
                $(this).load('@Url.Action("EditUser", "User")' + "/?p=" + selectedRows);
            }
        }

        $("#popupEditUser").dialog(configEdit);

        if (selectedRows.length > 1) {
            alert("Only one user can be selected to perform EDIT action!");
        } else if (selectedRows.length === 0) {
            alert("You need to select a user to perform EDIT action!");
        } else {
            $("#popupAddUser").dialog(configEdit).dialog("open");
        }
    });

    //#### REMOVE USER ####//
    $("#btnRemoveUser").on("click", function () {
        var selectedRows = $("#grid-basic").bootgrid("getSelectedRows");

        $.ajax({
            url: '@Url.Action("DeleteUser", "User")',
            type: 'POST',
            dataType: 'text',
            conventType: "application/json; charset=utf-8",
            data: { p: JSON.stringify(selectedRows) },
            complete: function () {
                $("#grid-basic").bootgrid("reload");
            },
            error: function (error) {
                alert("Failed to remove user!");
            }
        });
    });
</script>