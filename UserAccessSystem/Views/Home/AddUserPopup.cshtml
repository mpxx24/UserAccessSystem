@{
    ViewBag.Title = "Add user";
}

<div class="addUserFields">
    <div>
        @Html.Label("lbAddUser_Name", "Name")
        @Html.TextBox("tbAddUser_Name", "", new {@class = "form-control", style = "width: 100%;"})
    </div>
    <div>
        @Html.Label("lbAddUser_LastName", "Last name")
        @Html.TextBox("tbAddUser_LastName", "", new {@class = "form-control"})
    </div>
    <div>
        @Html.Label("lbAddUser_DateOfBirth", "Date of birth")
        @Html.Editor("dpAddUser_DateOfBirth")
    </div>
    <div>
        @Html.Label("lbAddUser_LastSubscriptionDate", "Last subscription")
        @Html.Editor("dpAddUser_LastSubscription")
    </div>
    <div>
        <button id="btnAddUser_Add" type="button" class="btn btn-primary" style="float: right">Add</button>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        ControlsHelper.CreateDatePicker("dpAddUser_DateOfBirth");
        ControlsHelper.CreateDatePicker("dpAddUser_LastSubscription");
    });
    
    $("#btnAddUser_Add").click(function () {
        var input = {
            FirstName: $("#tbAddUser_Name").val(),
            LastName: $("#tbAddUser_LastName").val(),
            DateOfBirth: $("#dpAddUser_DateOfBirth").val(),
            LastSubscription: $("#dpAddUser_LastSubscription").val()
        }
        
        $.ajax({
            url: '@Url.Action("SaveUser", "User")',
            type: 'POST',
            dataType: 'text',
            conventType: "application/json; charset=utf-8",
            data: { p: JSON.stringify(input) },
            complete: function () {
                $("#popupAddUser").dialog("close");
                $("#grid-basic").bootgrid("reload");
            },
            error: function (error) {
                alert("Failed to add user!");
                console.log(error, "WHYYYYYYYYYYY");
            }
        });
    });
</script>